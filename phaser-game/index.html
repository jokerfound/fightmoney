<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœæ‰“æ’¤ - ç”Ÿå­˜æ å¤ºæ¸¸æˆ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”«</text></svg>">
    <meta name="description" content="æœæ‰“æ’¤ - ä¸€æ¬¾ç´§å¼ åˆºæ¿€çš„ç”Ÿå­˜æ å¤ºæ¸¸æˆï¼Œä½“éªŒç‰©èµ„æœåˆ®ã€æˆ˜æ–—å¯¹æŠ—å’Œå®‰å…¨æ’¤ç¦»çš„ä¹è¶£">
    <meta name="keywords" content="æœæ‰“æ’¤,ç”Ÿå­˜æ¸¸æˆ,æ å¤ºæ¸¸æˆ,Phaseræ¸¸æˆ,HTML5æ¸¸æˆ">
    <meta name="author" content="FightMoney Game Team">
    
    <!-- å®‰å…¨ç­–ç•¥ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' data:; connect-src 'self' ws: wss:">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex, nofollow">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Microsoft YaHei', 'Segoe UI', 'PingFang SC', sans-serif;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }
        
        /* èƒŒæ™¯åŠ¨ç”»æ•ˆæœ */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(52, 152, 219, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(155, 89, 182, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(231, 76, 60, 0.05) 0%, transparent 50%);
            animation: backgroundPulse 8s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes backgroundPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, rgba(26, 82, 118, 0.95), rgba(10, 30, 45, 0.98));
            backdrop-filter: blur(15px);
            z-index: 1000;
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }
        
        .loading-content {
            text-align: center;
            max-width: 600px;
            padding: 3rem 2rem;
            position: relative;
        }
        
        /* è£…é¥°æ€§è¾¹æ¡† */
        .loading-content::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            border-radius: 20px;
            animation: borderGlow 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes borderGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(52, 152, 219, 0.3); }
            50% { box-shadow: 0 0 40px rgba(52, 152, 219, 0.6); }
        }
        
        .game-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, #3498db, #9b59b6, #e74c3c, #f1c40f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(52, 152, 219, 0.5);
            animation: titleGlow 2s ease-in-out infinite alternate;
            letter-spacing: 2px;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
            100% { text-shadow: 0 0 40px rgba(155, 89, 182, 0.7); }
        }
        
        .game-subtitle {
            font-size: 1.4rem;
            color: #bdc3c7;
            margin-bottom: 2rem;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .loading-text {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            color: #ecf0f1;
            line-height: 1.6;
            font-weight: 500;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 3rem;
        }
        
        .progress-container {
            width: 350px;
            height: 6px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 auto 2rem;
            position: relative;
        }
        
        .progress-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71, #f1c40f);
            border-radius: 3px;
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }
        
        .loading-status {
            font-size: 1.1rem;
            color: #95a5a6;
            margin-bottom: 1.5rem;
            font-weight: 500;
            min-height: 1.5rem;
        }
        
        .game-tips {
            font-size: 1rem;
            color: #7f8c8d;
            line-height: 1.5;
            margin-bottom: 2rem;
            font-style: italic;
        }
        
        .game-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        .feature-icon {
            font-size: 1.2rem;
        }
        
        #game-canvas {
            width: 100% !important;
            height: 100% !important;
            border: none;
            box-shadow: none;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2.8rem;
                margin-bottom: 1.2rem;
            }
            
            .game-subtitle {
                font-size: 1.2rem;
                margin-bottom: 1.5rem;
            }
            
            .loading-text {
                font-size: 1.1rem;
                margin-bottom: 2rem;
            }
            
            .progress-container {
                width: 280px;
            }
            
            .loading-content {
                padding: 2rem 1.5rem;
                max-width: 450px;
            }
            
            .game-features {
                gap: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .game-title {
                font-size: 2.2rem;
                margin-bottom: 1rem;
            }
            
            .game-subtitle {
                font-size: 1rem;
                margin-bottom: 1.2rem;
            }
            
            .loading-text {
                font-size: 0.9rem;
                margin-bottom: 1.5rem;
            }
            
            .progress-container {
                width: 240px;
            }
            
            .loading-content {
                padding: 1.5rem 1rem;
                max-width: 320px;
            }
            
            .game-features {
                flex-direction: column;
                gap: 0.8rem;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-dots {
            display: inline-block;
            margin-left: 5px;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <h1 class="game-title">ğŸ”« æœæ‰“æ’¤</h1>
                <p class="game-subtitle">ç”Ÿå­˜æ å¤ºæ¸¸æˆ</p>
                <p class="loading-text">ç‰©èµ„æœåˆ® â€¢ æˆ˜æ–—å¯¹æŠ— â€¢ å®‰å…¨æ’¤ç¦»</p>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <div class="loading-status" id="loadingStatus">æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆå¼•æ“<span class="loading-dots"></span></div>
                <p class="game-tips">æ­£åœ¨åŠ è½½æ¸¸æˆèµ„æºï¼Œè¯·ç¨å€™ç‰‡åˆ»...</p>
                
                <div class="game-features">
                    <div class="feature-item">
                        <span class="feature-icon">âš”ï¸</span>
                        <span>å¤šæ ·åŒ–æ­¦å™¨ç³»ç»Ÿ</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ“¦</span>
                        <span>ä¸°å¯Œç‰©å“æ”¶é›†</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ†</span>
                        <span>æˆå°±æŒ‘æˆ˜ç³»ç»Ÿ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ä¿®å¤favicon.ico 404é”™è¯¯
        if (!document.querySelector('link[rel="icon"]')) {
            const favicon = document.createElement('link');
            favicon.rel = 'icon';
            favicon.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ”«</text></svg>';
            document.head.appendChild(favicon);
        }
        
        // è·å–DOMå…ƒç´ 
        const loadingOverlay = document.getElementById('loadingOverlay');
        const progressBar = document.getElementById('progressBar');
        const loadingStatus = document.getElementById('loadingStatus');
        
        // åˆå§‹åŒ–è¿›åº¦æ¡
        progressBar.style.width = '0%';
        
        // æ¨¡æ‹ŸåŠ è½½è¿›åº¦
        let progress = 0;
        const maxProgress = 100;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= maxProgress) {
                progress = maxProgress;
                clearInterval(progressInterval);
            }
            progressBar.style.width = progress + '%';
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            if (progress < 30) {
                loadingStatus.innerHTML = 'æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆå¼•æ“<span class="loading-dots"></span>';
            } else if (progress < 60) {
                loadingStatus.innerHTML = 'æ­£åœ¨åŠ è½½æ¸¸æˆèµ„æº<span class="loading-dots"></span>';
            } else if (progress < 90) {
                loadingStatus.innerHTML = 'æ­£åœ¨å‡†å¤‡æ¸¸æˆåœºæ™¯<span class="loading-dots"></span>';
            } else {
                loadingStatus.innerHTML = 'æ¸¸æˆå³å°†å¼€å§‹<span class="loading-dots"></span>';
            }
        }, 200);
        
        // ç›‘å¬Phaseræ¸¸æˆå‡†å¤‡å°±ç»ªäº‹ä»¶
        window.addEventListener('phaser-game-ready', function() {
            console.log('Phaseræ¸¸æˆå·²å¯åŠ¨ï¼Œå‡†å¤‡éšè—åŠ è½½ç•Œé¢');
            
            // ç¡®ä¿è¿›åº¦æ¡å®Œæˆ
            progressBar.style.width = '100%';
            loadingStatus.innerHTML = 'æ¸¸æˆåŠ è½½å®Œæˆï¼';
            
            // æ·»åŠ å®ŒæˆåŠ¨ç”»
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                    console.log('åŠ è½½ç•Œé¢å·²éšè—');
                }, 600);
            }, 800);
        });
        
        // é¢å¤–çš„8ç§’è¶…æ—¶ä¿é™©ï¼Œç¡®ä¿æ¸¸æˆæ€»èƒ½æ˜¾ç¤º
        setTimeout(() => {
            if (loadingOverlay && !loadingOverlay.classList.contains('hidden')) {
                console.log('è¶…æ—¶å¼ºåˆ¶æ˜¾ç¤ºæ¸¸æˆ');
                loadingOverlay.classList.add('hidden');
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 600);
            }
        }, 8000);
        
        // å…¨é¢é˜²æ­¢æµè§ˆå™¨æ‰©å±•é”™è¯¯
        (function() {
            // æ•è·æ‰€æœ‰å¯èƒ½çš„é”™è¯¯ç±»å‹
            const errorPatterns = [
                'connection',
                'videoInWhiteList', 
                'runtime.lastError',
                'Receiving end does not exist',
                'Could not establish connection',
                'content.js',
                'chrome-extension',
                'extension'
            ];
            
            // å…¨å±€é”™è¯¯æ•è·
            window.onerror = function(message) {
                const messageStr = String(message || '');
                if (errorPatterns.some(pattern => messageStr.includes(pattern))) {
                    return true; // å®Œå…¨é˜»æ­¢æ‰©å±•é”™è¯¯
                }
                return false;
            };
            
            // Promiseé”™è¯¯æ•è·
            window.addEventListener('unhandledrejection', function(e) {
                const reasonStr = String(e.reason || '');
                if (errorPatterns.some(pattern => reasonStr.includes(pattern))) {
                    e.preventDefault();
                }
            });
            
            // console.errorå¤„ç†
            const originalConsoleError = console.error;
            console.error = function(...args) {
                const errorStr = args.join(' ');
                if (errorPatterns.some(pattern => errorStr.includes(pattern))) {
                    return; // å®Œå…¨å¿½ç•¥æ‰©å±•é”™è¯¯
                }
                originalConsoleError.apply(console, args);
            };
            
            // Chromeæ‰©å±•APIå®‰å…¨å¤„ç†
            if (typeof chrome !== 'undefined') {
                if (chrome.runtime) {
                    chrome.runtime.sendMessage = function() {
                        return Promise.resolve(); // é™é»˜å¤±è´¥
                    };
                }
                
                ['tabs', 'storage', 'cookies'].forEach(apiName => {
                    if (chrome[apiName] && typeof chrome[apiName] === 'object') {
                        for (let key in chrome[apiName]) {
                            if (typeof chrome[apiName][key] === 'function') {
                                chrome[apiName][key] = function() { return Promise.resolve(); };
                            }
                        }
                    }
                });
            }
            
            console.log('æµè§ˆå™¨æ‰©å±•é”™è¯¯é˜²æŠ¤å·²æ¿€æ´»');
        })();
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢DOMåŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥å¹¶ç§»é™¤å¯èƒ½çš„æ‰©å±•æ³¨å…¥è„šæœ¬
            const scripts = document.querySelectorAll('script[src*="content.js"], script[src*="chrome-extension"]');
            scripts.forEach(script => {
                if (script.parentNode) {
                    script.parentNode.removeChild(script);
                }
            });
        });
    </script>
    
    <script type="module" src="/src/main.ts"></script>
</body>
</html>